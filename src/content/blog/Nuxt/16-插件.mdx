---
title: æ’ä»¶
description: æ’ä»¶
pubDate: 2025-10-14
toc: true
ogImage: true
category: Nuxt
---

æ€è€ƒğŸ¤”ï¼šä»€ä¹ˆæ˜¯æ’ä»¶ï¼Ÿå’Œä¸­é—´ä»¶çš„åŒºåˆ«ï¼Ÿ

- ä¸­é—´ä»¶: å¯¹æ•°æ®æµåšä¸­é—´å¤„ç†
- æ’ä»¶ï¼šæ‰©å±•åº”ç”¨çš„åŠŸèƒ½

```ts
app.use(router).use(pinia).use(ElementPlus).mount('#app')
```

## æ’ä»¶åŸºç¡€çŸ¥è¯†

**åˆ›å»ºæ’ä»¶**

Nuxt æ¨èå°†æ’ä»¶æ”¾ç½®äº plugins ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼š

```
-| plugins/
---| foo.ts      // è¢«æ‰«æ
---| bar/
-----| baz.ts    // ä¸è¢«æ‰«æ
-----| foz.ts   // ä¸è¢«æ‰«æ
```

Nuxtä¼šè‡ªåŠ¨è¯»å– plugins ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œå¹¶åœ¨åˆ›å»º Vue åº”ç”¨ç¨‹åºæ—¶åŠ è½½å®ƒä»¬ã€‚è¿™æ„å‘³ç€è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ’ä»¶ï¼Œéƒ½æ˜¯è‡ªåŠ¨æ³¨å†Œçš„ï¼Œæ— éœ€å•ç‹¬å» nuxt.config.ts æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚

Nuxt é»˜è®¤åªä¼šæ‰«æä¸€å±‚ç›®å½•ã€‚å¦‚æœå¸Œæœ›æ‰«æå¤šå±‚ï¼Œéœ€è¦åœ¨ nuxt.config.ts æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚

```ts
export default defineNuxtConfig({
  plugins: ['~/plugins/bar/baz', '~/plugins/bar/foz'],
})
```

æ¯ä¸ªæ’ä»¶æ˜¯ä¸€ä¸ª ts æ–‡ä»¶ï¼Œä¼šå¯¼å‡º defineNuxtPlugin æ–¹æ³•çš„è°ƒç”¨ï¼š

```ts
export default defineNuxtPlugin()
```

defineNuxtPlugin æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°å°±æ˜¯æ’ä»¶çš„ä¸»é€»è¾‘ï¼Œå›è°ƒå‡½æ•°ä¼šè‡ªåŠ¨ä¼ å…¥ nuxtApp å‚æ•°ã€‚

```js
export default defineNuxtPlugin((nuxtApp) => {
  // ä½¿ç”¨nuxtAppåšä¸€äº›æ“ä½œ
})
```

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥æŒ‡å®šç‰¹å®šçš„ç¯å¢ƒä¸‹æ‰§è¡Œæ’ä»¶é€»è¾‘ï¼š

```ts
export default defineNuxtPlugin((nuxtApp) => {
  // æŒ‡å®šæ’ä»¶åªåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ
  if (import.meta.server) return
  // æ’ä»¶é€»è¾‘
})
```

**nuxtApp**

è¿™æ˜¯ä¸€ä¸ª**è¿è¡Œæ—¶ä¸Šä¸‹æ–‡å¯¹è±¡**ï¼Œæä¾›äº†è®¸å¤šå…¨å±€çš„å·¥å…·å’ŒåŠŸèƒ½ï¼Œè´¯ç©¿äºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿è¡Œæ—¶ã€‚å®˜æ–¹çš„æ–‡æ¡£ä»‹ç»åœ¨ [è¿™é‡Œ](https://nuxt.com/docs/guide/going-further/nuxt-app)ã€‚è¯¥å¯¹è±¡ä¸Šé¢æœ‰å¦‚ä¸‹çš„æˆå‘˜ï¼š

```ts
const nuxtApp = {
  vueApp, // å…¨å±€çš„Vueå®ä¾‹ï¼Œæœ‰äº›æ—¶å€™éœ€è¦æ‹¿åˆ°Vueå®ä¾‹ä»è€Œæ³¨å†ŒVueçš„æ’ä»¶æˆ–è€…è‡ªå®šä¹‰æŒ‡ä»¤

  versions, // Nuxtä»¥åŠVueçš„ç‰ˆæœ¬ä¿¡æ¯

  // These let you call and add runtime NuxtApp hooks
  // https://github.com/nuxt/nuxt/blob/main/packages/nuxt/src/app/nuxt.ts#L18
  hooks,
  hook,
  callHook,

  // ä»…åœ¨ SSR æœŸé—´å¯ç”¨ï¼Œä¸»è¦åŒ…å«ä¸€äº›å’ŒæœåŠ¡ç«¯ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
  ssrContext: {
    url,
    req,
    res,
    runtimeConfig,
    noSSR,
  },

  // æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ®è½½ä½“
  payload: {
    serverRendered: true, // æ˜¯å¦ä¸ºæœåŠ¡å™¨æ¸²æŸ“
    data: {}, // æœåŠ¡ç«¯è¦å‘å®¢æˆ·ç«¯è¿”å›çš„æ•°æ®
    state: {} // å®¢æˆ·ç«¯çš„åˆå§‹çŠ¶æ€
  }

  // æ³¨å†Œå…¨å±€åŠŸèƒ½æ¨¡å—
  provide: (name: string, value: any) => void
}

```

```ts
nuxtApp.hook('app:mounted', () => {})
```

è¯¥å¯¹è±¡å…·ä½“å¯¹åº”çš„å±æ€§å’Œæ–¹æ³•å¯ä»¥å‚é˜…[è¿™é‡Œ](https://nuxt.com/docs/api/composables/use-nuxt-app)ã€‚

åœ¨ä½¿ç”¨ defineNuxtPlugin åˆ›å»ºæ’ä»¶æ—¶ï¼Œå›è°ƒå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥ä¸º nuxtApp å¯¹è±¡æä¾›æ‰©å±•å†…å®¹ï¼š

```ts
export default defineNuxtPlugin(() => {
  // ä¸ºnuxtAppå¯¹è±¡æä¾›æ‰©å±•å†…å®¹
  return {
    provide: {
      //...
    },
  }
})
```

**å¯¹è±¡å†™æ³•**

é™¤äº†å›è°ƒå‡½æ•°çš„å½¢å¼ï¼ŒdefineNuxtPlugin è¿˜æ”¯æŒå¯¹è±¡å†™æ³•ï¼š

```js
export default defineNuxtPlugin({
  name: 'my-plugin',
  enforce: 'pre',
  async setup(nuxtApp) {},
  hooks: {
    'app:created'() {
      const nuxtApp = useNuxtApp()
    },
  },
  env: {
    islands: true,
  },
})
```

- nameï¼šæ’ä»¶çš„åç§°
- enforceï¼šæ’ä»¶åŠ è½½çš„é¡ºåº
  - preï¼šä½ çš„è¿™ä¸ªæ’ä»¶åœ¨ Nuxt æ ¸å¿ƒæ’ä»¶åŠ è½½ä¹‹å‰è¿è¡Œ
  - postï¼šä½ çš„è¿™ä¸ªæ’ä»¶åœ¨ Nuxt æ ¸å¿ƒæ’ä»¶åŠ è½½ä¹‹åè¿è¡Œ

- setupï¼šæ’ä»¶çš„ä¸»è¦é€»è¾‘
- hooksï¼šå¯¹åº”ä¸Šé¢çš„ hooks
- envï¼šæ§åˆ¶æ’ä»¶çš„è¿è¡Œç¯å¢ƒ
  - islandsï¼šæ’ä»¶æ˜¯å¦åœ¨å²›å±¿ç»„ä»¶ä¸­è¿è¡Œ

**åŠ è½½æ’ä»¶**

Nuxt åº”ç”¨åœ¨åŠ è½½æ’ä»¶çš„æ—¶å€™ï¼Œå’ŒåŠ è½½ä¸­é—´ä»¶ä¸€æ ·ï¼Œ**æŒ‰ç…§ ASCII ç é¡ºåº**è¿›è¡ŒåŠ è½½ã€‚å¦‚æœå¸Œæœ›æ”¹å˜åŠ è½½çš„é¡ºåºï¼Œåœ¨æ’ä»¶æ–‡ä»¶å‰é¢æ·»åŠ åºå·å³å¯ï¼š

```
plugins/
 | - 01.myPlugin.ts
 | - 02.myOtherPlugin.ts
```

åŠ è½½æ’ä»¶æ—¶é»˜è®¤æ˜¯æŒ‰ç…§é¡ºåºè¿›è¡ŒåŠ è½½ï¼Œå°† parallel è®¾ç½®ä¸º true å¯è®¾ç½®ä¸ºå¹¶è¡ŒåŠ è½½ï¼ŒNuxt ä¸ä¼šç­‰åˆ°è¯¥æ’ä»¶æ‰§è¡Œç»“æŸï¼Œè€Œæ˜¯ä¼šç›´æ¥åŠ è½½ä¸‹ä¸€ä¸ªæ’ä»¶ã€‚

```ts
export default defineNuxtPlugin({
  name: 'my-plugin',
  parallel: true, // åŠ è½½è¿™ä¸ªæ’ä»¶çš„æ—¶å€™ï¼Œæ˜¯å¹¶è¡ŒåŠ è½½ï¼Œä¸ç”¨ç­‰åˆ°è¯¥æ’ä»¶åŠ è½½ç»“æŸï¼Œç›´æ¥å¼€å§‹åŠ è½½ä¸‹ä¸€ä¸ªæ’ä»¶
  async setup(nuxtApp) {
    // ä¸‹ä¸€ä¸ªæ’ä»¶å°†ç«‹å³æ‰§è¡Œ
  },
})
```

**ä½¿ç”¨ç»„åˆå¼APIä»¥åŠå·¥å…·å‡½æ•°**

åœ¨æ’ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„æˆ–è€…è‡ªå®šä¹‰çš„ç»„åˆå¼ API ä»¥åŠå·¥å…·å‡½æ•°ã€‚ä¾‹å¦‚ï¼š

```ts
// composables/useFoo.ts
export const useFoo = () => {
  return useState('foo', () => 'bar')
}
```

```ts
// plugins/hello.ts
export default defineNuxtPlugin((nuxtApp) => {
  const foo = useFoo()
  console.log(foo.value)
})
```

å¯åŠ¨åº”ç”¨åï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ’ä»¶ä»£ç ã€‚

## æ³¨å†ŒVueæ’ä»¶

Vueä¹Ÿæ˜¯æ”¯æŒæ’ä»¶çš„ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨ Vue æ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ Nuxt æ’ä»¶æ¥é—´æ¥çš„è¿›è¡Œæ³¨å†Œã€‚å…ˆè·å–åˆ° Vue çš„å®ä¾‹

ä¾‹å¦‚ï¼Œåœ¨Vueé¡¹ç›®é‡Œé¢ï¼Œä½¿ç”¨ [vue-gtag ](https://matteo-gabriele.gitbook.io/vue-gtag)è¿™ä¸ªæ’ä»¶æ¥æ·»åŠ  Google Analytics æ ‡ç­¾ï¼š

```js
import { createApp } from 'vue'
import App from './App.vue'
// å¼•å…¥
import VueGtag from 'vue-gtag'
const app = createApp(App)
// æ³¨å†Œ
app
  .use(VueGtag, {
    config: { id: 'GA_MEASUREMENT_ID' },
  })
  .mount('#app')
```

å¦‚æœæƒ³è¦åœ¨ Nuxt é¡¹ç›®ä¸­ä½¿ç”¨è¯¥æ’ä»¶ï¼š

```ts
import VueGtag, { trackRouter } from 'vue-gtag-next'

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.use(VueGtag, {
    property: {
      id: 'GA_MEASUREMENT_ID',
    },
  })
  trackRouter(useRouter())
})
```

**è¯¾å ‚ç»ƒä¹ **

å®ç°ä¸€ä¸ªå…¨å±€äº‹ä»¶æ€»çº¿æ’ä»¶ï¼Œåœ¨ä¸å¼•å…¥çŠ¶æ€ç®¡ç†å·¥å…·(pinia or vuex)çš„æƒ…å†µä¸‹è¿›è¡Œç»„ä»¶é€šä¿¡ã€‚

---

-EOF-
